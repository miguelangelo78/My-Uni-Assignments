\documentclass[9pt, a4paper]{report}
\usepackage{pdfpages}
\usepackage[nottoc]{tocbibind}
\usepackage[backend=bibtex, autocite=superscript, sortcites=true, citestyle=numeric]{biblatex}
\usepackage{fancyhdr}
\usepackage{extramarks}
\usepackage{lastpage}
\usepackage{listings}
\usepackage[toc,page]{appendix}
\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{subfiles}
\usepackage{accsupp}
\usepackage{fnpct}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{xcolor,colortbl}
\usepackage{color}
\pdfmapfile{+zi4.map}
\usepackage{zi4}

\addbibresource{references/references.bib}
\AdaptNoteOpt\footcite\multfootcite

\newcommand{\imagespath}{res/img/}
\newcommand{\images}[1]{\imagespath #1}
\newcommand{\plotspath}{res/plots/}
\newcommand{\plots}[1]{\plotspath #1}
\newcommand{\programspath}{res/MATLAB Code/}
\newcommand{\programs}[1]{"\programspath #1"}

\graphicspath{{\imagespath}{\plotspath}{\programspath}}

% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.25in
\linespread{1.1} % Line spacing

% Header and footer
\pagestyle{fancy}
\lhead{14031329} % Top left header
\chead{NG4S800\ Satellite Networking: Coursework} % Top center head
\rhead{\firstxmark} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{1.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule

\setlength\parindent{0pt} % Removes all indentation from paragraphs

\author{14031329\\Miguel Santos}
\date{08 January 2018\\2017/2018}

\newcommand{\quotes}[1]{``#1''}
\newcommand{\squotes}[1]{`#1'}

\newcommand{\newsubsection}[1]{
\newpage
\addcontentsline{toc}{section}{#1}
\subsection*{#1}
}

\newcommand{\newchapter}[2]{
\addcontentsline{toc}{chapter}{#1}
\subsection*{\Large #1}\normalfont
\subfile{chapter/#2}
}

\newcommand{\newprogram}[1]{
\section{#1}
}

\newcommand{\showplot}[2]{
\begin{figure}[!h]
\vspace*{-0.4cm}
\centerline{\includegraphics[scale=0.55]{\plots{#1}}}
\vspace*{-0.9cm}
\caption{\tiny #2}
\end{figure}
}

\newcommand{\showimage}[2]{
\begin{figure}[!h]
\centering
\hspace*{3.5cm}\includegraphics[scale=0.55]{\images{#1}}
\label{fig:#2}
\caption{\scriptsize #2}
\end{figure}
}

\lstset{ %
  backgroundcolor=\color{white}, % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
  basicstyle=\scriptsize\fontfamily{zi4}\selectfont, % the size and type of the fonts that are used for the code
  breakatwhitespace=false,           % sets if automatic breaks should only happen at whitespace
  breaklines=true,                   % sets automatic line breaking
  captionpos=b,                      % sets the caption-position to bottom
  commentstyle=\color[rgb]{0,0.6,0}, % comment style            
  escapeinside={\%*}{*)},          
  extendedchars=true,              
  frame=lines,                       % adds a frame around the code
  keepspaces=true,                   % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},         % keyword style
  language=Matlab,   
  numbers=left,                      % where to put the line-numbers; possible values are (none, left, right)
  numbersep=10pt,                    % how far the line-numbers are from the code
  numberstyle=\scriptsize\fontfamily{zi4}\selectfont\color[rgb]{0.5,0.5,0.5}\noncopynumber, % the style that is used for the line-numbers
  rulecolor=\color{black}, 
  showstringspaces=false,
  showtabs=false,        
  stringstyle=\color[rgb]{0.58,0,0.82}, % string literal style
  tabsize=4,                            % sets default tabsize to 4 spaces
  columns=flexible,
  upquote=true
}

\renewcommand{\lstlistingname}{\scriptsize Code}

\newcommand{\noncopynumber}[1]{
    \BeginAccSupp{method=escape,ActualText={}}
    #1
    \EndAccSupp{}
}

\begin{document}

        \includepdf[pages=-]{chapter/cover.pdf}
        
        \newchapter{Task 1}{task1}
        \newchapter{Task 2}{task2}
        \newchapter{Task 3}{task3}      
        
        \addcontentsline{toc}{chapter}{References}
        \renewcommand{\bibname}{References}
        \printbibliography
        
        \newpage
        \begin{appendices}
                \chapter{MATLAB Code}
                \newprogram{ErlangB.m}
                \lstinputlisting[caption=ErlangB.m]{\programs{ErlangB.m}}
                
                \newprogram{task2\_i.m}
                \lstinputlisting[caption=task2\_i.m]{"res/MATLAB Code/task2_i.m"}
                
                \newpage
                \newprogram{task2\_ii\_a.m}
                \lstinputlisting[caption=task2\_ii\_a.m]{"res/MATLAB Code/task2_ii_a.m"}
                
                \newprogram{task2\_ii\_b.m}
                \lstinputlisting[caption=task2\_ii\_b.m]{"res/MATLAB Code/task2_ii_b.m"}
                
                \newprogram{plot\_N\_vs\_PB.m}
                \lstinputlisting[caption=plot\_N\_vs\_PB.m]{"res/MATLAB Code/plot_N_vs_PB.m"}
		\end{appendices}        
        
\end{document}